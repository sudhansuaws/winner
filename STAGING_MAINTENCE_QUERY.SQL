
STAGING TABLE BACK UP SCRIPTS 
------------------------------

1) FOR THIS TIME, DUE TO HUGE DATA IN THE STAGING TABLE
------------------------------------------------------

CREATE TABLE STG_14082020 PARALLEL NOLOGGING  AS SELECT * FROM PSX_COMMON_STAGING_T WHERE EOD_BATCH_ID IS NULL;
ALTER TABLE STG_14082020 NOPARALLEL;

RENAME PSX_COMMON_STAGING_T TO PSX_COMMON_STAGING_T_14082020;
RENAME STG_14082020 TO PSX_COMMON_STAGING_T;

DROP INDEX INST_IDX;
DROP INDEX STG_LCHGTIME;
DROP INDEX EODBATCHIDINX;
DROP INDEX SOURCESYSTEMINX;
DROP INDEX STG_CUST_UNQ_ID;
DROP INDEX CUSTOMERNOSTGINDX;
DROP INDEX PENDING_ID_CMN_STG;
DROP INDEX IDX_STAGING_BATCHID;
DROP INDEX PSX_BATCH_ID_IDX_STG;
DROP INDEX PSX_COMMON_STAGING_T_IDXX1;

CREATE INDEX CUSTOMERNOSTGINDX ON PSX_COMMON_STAGING_T (CUSTOMER_NO);
CREATE INDEX EODBATCHIDINX ON PSX_COMMON_STAGING_T (EOD_BATCH_ID);
CREATE INDEX IDX_STAGING_BATCHID ON PSX_COMMON_STAGING_T (BATCHID);
CREATE INDEX INST_IDX ON PSX_COMMON_STAGING_T (INSERT_TIME);
CREATE INDEX PENDING_ID_CMN_STG ON PSX_COMMON_STAGING_T (PENDING_ID);
CREATE INDEX PSX_BATCH_ID_IDX_STG ON PSX_COMMON_STAGING_T (PSX_BATCH_ID);
CREATE INDEX PSX_COMMON_STAGING_T_IDXX1 ON PSX_COMMON_STAGING_T (CUSTOMER_ID, SOURCE_SYS_ID, BATCHID);
CREATE INDEX SOURCESYSTEMINX ON PSX_COMMON_STAGING_T (SOURCE_SYSTEM);
CREATE INDEX STG_CUST_UNQ_ID ON PSX_COMMON_STAGING_T (CUST_UNQ_ID);
CREATE INDEX STG_LCHGTIME ON PSX_COMMON_STAGING_T (LCHGTIME);


2) NEXT TIME ONWARDS  IN  THE MAINTENCE ACTIVITY
---------------------------------------------------

CREATE TABLE PSX_COMMON_STAGING_T_BKP PARALLEL NOLOGGING  AS SELECT * FROM PSX_COMMON_STAGING_T WHERE EOD_BATCH_ID IS NOT NULL AND TRUNC(INSERT_TIME) < TRUNC(SYSDATE - <<NO.OF.DAYS>>);
ALTER TABLE PSX_COMMON_STAGING_T_BKP NOPARALLEL;

DELETE FROM PSX_COMMON_STAGING_T WHERE EOD_BATCH_ID IS NOT NULL AND TRUNC(INSERT_TIME) < TRUNC(SYSDATE - <<NO.OF.DAYS>>);
COMMIT;

3) GATHER STATS
Begin
Dbms_Stats.Gather_Table_Stats(User,'psx_common_staging_t',Degree=>5);
END;
(or)
BEGIN
DBMS_STATS.GATHER_TABLE_STATS('POSIDEX360_PRD', PSX_COMMON_STAGING_Tâ€™);
END;